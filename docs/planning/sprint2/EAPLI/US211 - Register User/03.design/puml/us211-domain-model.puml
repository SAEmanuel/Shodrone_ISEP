@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

title UI Sequence Diagram (SSD) - Register User Flow (US211)

autonumber

actor "Admin User" as user
participant ":RegisterUserUI" as UI
participant ":RegisterUserController" as CTRL
participant ":RepositoryProvider" as repoProvider
participant ":UserRepository" as userRepoInterface
participant ":UserRepositoryJPAImpl" as userJPA
participant ":UserRoleRepository" as roleRepo
participant ":Email" as emailVO
participant ":Password" as pwdVO
participant ":User" as userEntity

== START ==

user -> UI : inputs name, email, phone, password, role
activate UI
UI -> CTRL : registerUser(name, email, phone, password, roleId)
activate CTRL

CTRL -> repoProvider : userRepository()
activate repoProvider
repoProvider --> CTRL : userRepoInterface
deactivate repoProvider

CTRL -> userRepoInterface : existsByEmail(email)
activate userRepoInterface
alt email already exists
    userRepoInterface --> CTRL : true
    CTRL --> UI : show error "Email already in use"
    deactivate userRepoInterface
else email not in use
    userRepoInterface --> CTRL : false
    deactivate userRepoInterface

    CTRL -> roleRepo : findById(roleId)
    activate roleRepo
    roleRepo --> CTRL : UserRole
    deactivate roleRepo

    CTRL -> emailVO : new Email(email)
    CTRL -> pwdVO : new Password(password)  // hashed internally

    CTRL -> userEntity : new User(name, email, phone, password, role)
    activate userEntity
    userEntity --> CTRL : user
    deactivate userEntity

    CTRL -> userRepoInterface : save(user)
    activate userRepoInterface
    userRepoInterface --> CTRL : void
    deactivate userRepoInterface

    CTRL --> UI : show success
end

deactivate CTRL
@enduml
