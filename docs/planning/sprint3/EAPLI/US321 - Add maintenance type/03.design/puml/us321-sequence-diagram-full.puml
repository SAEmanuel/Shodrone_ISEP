@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

title UI Sequence Diagram (SD) - Add Maintenance Type

autonumber

actor "Drone Tech" as DT
participant ":AddMaintenanceTypeUI" as UI
participant "MaintenanceTypeName" as NameVO
participant "Description" as DescVO
participant ":AddMaintenanceTypeController" as CTRL
participant ":RepositoryProvider" as Provider
participant ":MaintenanceTypeRepository" as Repo
participant ":InMemoryMaintenanceTypeRepository" as InMem
participant ":MaintenanceTypeJPAImpl" as JPA
participant "MaintenanceType" as MT

activate DT

DT -> UI: requests to add a maintenance type
activate UI

UI -> NameVO : Utils.rePromptWhileInvalid()
activate NameVO
NameVO -> UI: maintenanceTypeName
deactivate NameVO

UI -> UI: promptForDescription()
alt hasDescription is true
    UI -> DescVO : Utils.rePromptWhileInvalid()
    activate DescVO
    DescVO -> UI: description
    deactivate DescVO
else
    note right: skips description
end

UI -> CTRL : create
activate CTRL
alt hasDescription is true
    UI -> CTRL: createMaintenanceType(maintenanceTypeName, description)
    CTRL -> MT : new(maintenanceTypeName, description)
else
    UI -> CTRL: createMaintenanceTypeWithoutDescription(maintenanceTypeName)
    CTRL -> MT : new(maintenanceTypeName)
end
activate MT
MT --> CTRL: MaintenanceType instance
deactivate MT

CTRL -> Provider : maintenanceTypeRepository()
activate Provider
Provider --> CTRL: repository (dynamic: InMem or JPA)
deactivate Provider

alt Repository is InMemoryMaintenanceTypeRepository
    CTRL -> InMem: save(maintenanceType)
    activate InMem
    InMem -> InMem: containsKey(maintenanceType.identity())
    InMem --> CTRL: Optional<MaintenanceType>
    deactivate InMem
else Repository is MaintenanceTypeJPAImpl
    CTRL -> JPA: save(maintenanceType)
    activate JPA
    JPA --> CTRL: Optional<MaintenanceType>
    deactivate JPA
end

CTRL --> UI: Optional<MaintenanceType>
deactivate CTRL

alt MaintenanceType saved successfully
    UI --> DT: successMessage("Maintenance type created successfully!")
else Save failed (duplicate name)
    UI --> DT: errorMessage("A Maintenance Type with that name already exists!")
end

deactivate UI
deactivate DT

@enduml